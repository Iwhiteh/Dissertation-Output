---
title: '2.11'
output: pdf_document
date: "2022-10-27"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning=FALSE) #doesn't show code or error messages in knit
```

```{r library, message=FALSE, include=FALSE} 
#don't print outputs
library(dplyr)
library(tidyverse) 
library(knitr)
library(readr)
library(ggplot2)
```

```{r block}
(load("stomach_dataset.Rdata")) #change to access via github repository
#the dataset is already named stom_df
stom_df
df <- stom_df %>% transmute(haul_id, latitude, longitude, year, pred_species, pred_weight_g, pred_length_cm, prey_species, prey_type = prey_funcgrp, indiv_prey_weight = prey_ind_weight_g, no._prey_per_stmch = prey_count / n_stomachs, ppmr) 
df

any(df$pred_weight_g == 0)
#any entries satisfy --> true
anyNA(df$pred_weight_g)

any(df$indiv_prey_weight == 0)

prey_weight_fixed = df$indiv_prey_weight[df$indiv_prey_weight != 0]
```

\newpage

prey weight v. number density of prey

```{r indiv_prey_weight v. no. density of prey}

df_smaller <- df[1:5000,]
#a smaller sample of the overall data set

ggplot(data = df_smaller, aes(indiv_prey_weight, no._prey_per_stmch)) + labs(title = "prey weight v. number density of prey", x="prey weight", y="No. density of prey") + geom_point(size=0.75)

ggplot(data = df_smaller, aes(log(indiv_prey_weight), no._prey_per_stmch)) + labs(title = "log(prey weight) v. number density of prey", x="log(prey weight)", y="No. density of prey") + geom_point(size=0.5)
#Some interesting results --> introduce colours to show ships  

df_smaller$'haul_id_short' <- gsub("\\-.*", "", df_smaller$'haul_id')
#rename haul_id values -> separate by ship names (e.g. CLYDE) rather than complete id (e.g. CLYDE-1935-6)

#separated by ship names
ggplot(data = df_smaller, aes(log(indiv_prey_weight), no._prey_per_stmch, colour=haul_id_short)) + labs(title = "log(prey weight) v. number prey per stomach - separate ship names", x="log(prey weight)", y="No. density of prey") + geom_point(size=0.5) + theme(plot.title = element_text(size=10))
```

\newpage

prey weight v. pred weight

```{r prey weight v. pred weight}
df_smaller <- df[1:5000,]
#a smaller sample of the overall data set

ggplot (data = df_smaller, aes(indiv_prey_weight, pred_weight_g)) + geom_point(size=0.5) + labs(title = "Predator v. prey mass plot", x="Prey weight(g)", y="Predator weight (g)")

ggplot(data = df_smaller, aes(log(indiv_prey_weight), log(pred_weight_g))) + geom_point(size=0.5) + labs(title = "log(Predator mass) v. log(prey mass) plot", x="log(Prey weight)", y="log(Predator weight)") + stat_smooth (method='lm', se=FALSE)

slope <- coef(lm(df_smaller$pred_weight_g~df_smaller$indiv_prey_weight))
slope 
#gives the slope of the log(pred) v. log(prey) line of best fit --> change to log values

log_pred_weight <- log(df_smaller$pred_weight_g)
log_prey_weight <- log(df_smaller$indiv_prey_weight)

ggplot(data = df_smaller, aes(log_prey_weight , log_pred_weight)) + geom_point(size=0.5) + labs(title = "Predator v. prey log(mass) plot", x="log(Prey weight)", y="log(Predator weight)") + stat_smooth (method='lm', se=FALSE)

log_pred_weight_fixed = log_pred_weight[is.na(df) | df=="Inf"] = NA

#slope2 <- coef(lm((log_prey_weight)~(log_pred_weight_fixed)))
#had error code bc some values in log_pred_weight give 'Inf' or 'NA' or 'NaN'
#'variable lengths differ' error for log_pred_weight
#slope2
```

-----
log(PPMR) v. number density of prey

```{r log(PPMR) v. prey no. density, fig.align="center", out.width='100%'}
df_smaller <- df[1:1000,]
#a smaller sample of the overall data set

ggplot(data = df_smaller, aes(log(ppmr), no._prey_per_stmch)) + labs(title = "Scatter plot: log(PPMR) v. number density of prey", x="log(PPMR)", y="no._prey_per_stmch") + geom_point(size=0.5)
#gives the most common PPMR for fish

ggplot(data = df_smaller, aes(x=log(ppmr))) + labs(title = "Density plot: log(PPMR) v. number density of prey", x="log(PPMR)", y="No. observations") + geom_histogram(binwidth=.5, colour="black", fill="white")
#Using a density plot (rather than scatter plots)

#Separated into individual plots for each species -> using facet_wrap for the variable (pred_species)
ggplot(data = df_smaller, aes(x=log(ppmr), y=no._prey_per_stmch), group=1) + labs(title = "Scatter plot: log(PPMR) v. number density of prey separated by species", x="log(PPMR)", y="No. density of prey") + geom_point(size=0.2) + facet_wrap(~pred_species) + theme(strip.text = element_text(size = 5))

#Changed into a density plot
ggplot(data = df_smaller, aes(x=log(ppmr)), group=1) + labs(title = "Density plot: log(PPMR) v. number density of prey separated by species", x="log(PPMR)", y="No. density of prey") + geom_histogram(binwidth=.5, colour="black", fill="white") + facet_wrap(~pred_species, scale="free_y") + theme(strip.text = element_text(size = 5))
#change size of plots

first_species <- df_smaller %>% filter(pred_species == fixed("Clupea harengus"))
#separate data set of a single species

ggplot(data = first_species, aes(x=log(ppmr)), group=1) + labs(title = "Density plot: log(PPMR) v. number density of prey separated by species - Clupea harengus", x="log(PPMR)", y="No. density of prey") + geom_histogram(binwidth=.5, colour="black", fill="white") + theme(plot.title = element_text(size=15))
```

